<!doctype html><html lang=vi-vn><head><meta charset=utf-8><title></title><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=https://qtrungvn.github.io/myblog_qtrung/css/main.min.49689da3cfe3cc0b12afb45776349f32d2eef4d5ad8244ce26fb7f01d91d5d43.css></head><body><header><nav><a href=../../>Home</a>
<a href=../../posts>Blog</a>
<a href=../../about>About Me</a>
<a href=../../contact>Contact</a></nav><button id=dark-mode-toggle><i class="fas fa-moon"></i></button></header><main><section class=page><div class=container><h1></h1><div class=page-content><p>Multithreading cho phép chương trình thực hiện nhiều tác vụ đồng thời, tăng hiệu suất và responsiveness. Java cung cấp các API mạnh mẽ để làm việc với threads.</p><h2 id=cơ-bản-về-thread>Cơ bản về Thread</h2><p>Thread là đơn vị thực thi nhỏ nhất trong một process. Java cung cấp hai cách tạo thread:</p><h3 id=1-extend-thread-class>1. Extend Thread class</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyThread</span> <span style=color:#66d9ef>extends</span> Thread {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>() {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread đang chạy: &#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Count: &#34;</span> <span style=color:#f92672>+</span> i);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>sleep</span>(1000); <span style=color:#75715e>// Ngủ 1 giây</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ThreadExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        MyThread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyThread();
</span></span><span style=display:flex><span>        MyThread thread2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyThread();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>start</span>(); <span style=color:#75715e>// Khởi động thread</span>
</span></span><span style=display:flex><span>        thread2.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Main thread kết thúc&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-implement-runnable-interface-khuyến-khích>2. Implement Runnable interface (khuyến khích)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyRunnable</span> <span style=color:#66d9ef>implements</span> Runnable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>() {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Runnable đang chạy: &#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Task &#34;</span> <span style=color:#f92672>+</span> i <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; completed&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>sleep</span>(500);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>interrupt</span>(); <span style=color:#75715e>// Khôi phục trạng thái interrupt</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RunnableExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Thread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(<span style=color:#66d9ef>new</span> MyRunnable(), <span style=color:#e6db74>&#34;Thread-1&#34;</span>);
</span></span><span style=display:flex><span>        Thread thread2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(<span style=color:#66d9ef>new</span> MyRunnable(), <span style=color:#e6db74>&#34;Thread-2&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>        thread2.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Chờ thread kết thúc</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            thread1.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>            thread2.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Tất cả threads đã kết thúc&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=thread-lifecycle>Thread Lifecycle</h2><p>Một thread có các trạng thái:</p><ol><li><strong>NEW</strong>: Thread được tạo nhưng chưa start</li><li><strong>RUNNABLE</strong>: Thread đang chạy hoặc sẵn sàng chạy</li><li><strong>BLOCKED</strong>: Thread đang chờ lock</li><li><strong>WAITING</strong>: Thread đang chờ một thread khác</li><li><strong>TIMED_WAITING</strong>: Thread đang chờ với timeout</li><li><strong>TERMINATED</strong>: Thread đã kết thúc</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ThreadLifecycleDemo</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Thread thread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread state: &#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getState</span>());
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>sleep</span>(2000);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Before start: &#34;</span> <span style=color:#f92672>+</span> thread.<span style=color:#a6e22e>getState</span>()); <span style=color:#75715e>// NEW</span>
</span></span><span style=display:flex><span>        thread.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;After start: &#34;</span> <span style=color:#f92672>+</span> thread.<span style=color:#a6e22e>getState</span>()); <span style=color:#75715e>// RUNNABLE</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            Thread.<span style=color:#a6e22e>sleep</span>(100);
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;During sleep: &#34;</span> <span style=color:#f92672>+</span> thread.<span style=color:#a6e22e>getState</span>()); <span style=color:#75715e>// TIMED_WAITING</span>
</span></span><span style=display:flex><span>            thread.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;After join: &#34;</span> <span style=color:#f92672>+</span> thread.<span style=color:#a6e22e>getState</span>()); <span style=color:#75715e>// TERMINATED</span>
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=synchronization>Synchronization</h2><p>Synchronization đảm bảo chỉ một thread có thể truy cập vào một tài nguyên tại một thời điểm.</p><h3 id=synchronized-methods>synchronized methods</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Counter</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>increment</span>() {
</span></span><span style=display:flex><span>        count<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCount</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> count;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SynchronizationExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        Counter counter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Counter();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Runnable task <span style=color:#f92672>=</span> () <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 1000; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                counter.<span style=color:#a6e22e>increment</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(task);
</span></span><span style=display:flex><span>        Thread thread2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(task);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>        thread2.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>        thread2.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Final count: &#34;</span> <span style=color:#f92672>+</span> counter.<span style=color:#a6e22e>getCount</span>()); <span style=color:#75715e>// 2000</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=synchronized-blocks>synchronized blocks</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SynchronizedBlockExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object lock <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>increment</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span> (lock) {
</span></span><span style=display:flex><span>            count<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCount</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span> (lock) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> count;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=thread-communication>Thread Communication</h2><h3 id=wait-notify-notifyall>wait(), notify(), notifyAll()</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProducerConsumer</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object lock <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> itemAvailable <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>produce</span>() <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span> (lock) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> (itemAvailable) {
</span></span><span style=display:flex><span>                lock.<span style=color:#a6e22e>wait</span>(); <span style=color:#75715e>// Chờ consumer tiêu thụ</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Sản xuất item&#34;</span>);
</span></span><span style=display:flex><span>            itemAvailable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            lock.<span style=color:#a6e22e>notify</span>(); <span style=color:#75715e>// Thông báo cho consumer</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>consume</span>() <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span> (lock) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!</span>itemAvailable) {
</span></span><span style=display:flex><span>                lock.<span style=color:#a6e22e>wait</span>(); <span style=color:#75715e>// Chờ producer sản xuất</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Tiêu thụ item&#34;</span>);
</span></span><span style=display:flex><span>            itemAvailable <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            lock.<span style=color:#a6e22e>notify</span>(); <span style=color:#75715e>// Thông báo cho producer</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProducerConsumerDemo</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        ProducerConsumer pc <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ProducerConsumer();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread producer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                    pc.<span style=color:#a6e22e>produce</span>();
</span></span><span style=display:flex><span>                    Thread.<span style=color:#a6e22e>sleep</span>(1000);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>interrupt</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread consumer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                    pc.<span style=color:#a6e22e>consume</span>();
</span></span><span style=display:flex><span>                    Thread.<span style=color:#a6e22e>sleep</span>(1500);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>interrupt</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        producer.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>        consumer.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=volatile-keyword>Volatile Keyword</h2><p>Volatile đảm bảo visibility của biến giữa các threads.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VolatileExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>boolean</span> running <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>stop</span>() {
</span></span><span style=display:flex><span>        running <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (running) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Do some work</span>
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Running...&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>sleep</span>(1000);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>interrupt</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Stopped&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        VolatileExample example <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> VolatileExample();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread worker <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(example::run);
</span></span><span style=display:flex><span>        worker.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(3000);
</span></span><span style=display:flex><span>        example.<span style=color:#a6e22e>stop</span>();
</span></span><span style=display:flex><span>        worker.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=thread-pool-với-executorservice>Thread Pool với ExecutorService</h2><p>Thread pool quản lý lifecycle của threads hiệu quả hơn.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.TimeUnit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ThreadPoolExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Tạo thread pool với 3 threads</span>
</span></span><span style=display:flex><span>        ExecutorService executor <span style=color:#f92672>=</span> Executors.<span style=color:#a6e22e>newFixedThreadPool</span>(3);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> taskId <span style=color:#f92672>=</span> i;
</span></span><span style=display:flex><span>            executor.<span style=color:#a6e22e>submit</span>(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Task &#34;</span> <span style=color:#f92672>+</span> taskId <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; executed by &#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                    Thread.<span style=color:#a6e22e>sleep</span>(2000);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>                    Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>interrupt</span>();
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Shutdown executor</span>
</span></span><span style=display:flex><span>        executor.<span style=color:#a6e22e>shutdown</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Chờ tất cả tasks hoàn thành hoặc timeout</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>executor.<span style=color:#a6e22e>awaitTermination</span>(10, TimeUnit.<span style=color:#a6e22e>SECONDS</span>)) {
</span></span><span style=display:flex><span>                executor.<span style=color:#a6e22e>shutdownNow</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            executor.<span style=color:#a6e22e>shutdownNow</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=callable-và-future>Callable và Future</h2><p>Callable trả về kết quả, Future để lấy kết quả.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Callable;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutionException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Future;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CallableFutureExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        ExecutorService executor <span style=color:#f92672>=</span> Executors.<span style=color:#a6e22e>newFixedThreadPool</span>(2);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Callable<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> task <span style=color:#f92672>=</span> () <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            Thread.<span style=color:#a6e22e>sleep</span>(2000);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> 42;
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Future<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> future <span style=color:#f92672>=</span> executor.<span style=color:#a6e22e>submit</span>(task);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Task submitted, doing other work...&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Lấy kết quả (blocking)</span>
</span></span><span style=display:flex><span>            Integer result <span style=color:#f92672>=</span> future.<span style=color:#a6e22e>get</span>();
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Result: &#34;</span> <span style=color:#f92672>+</span> result);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException <span style=color:#f92672>|</span> ExecutionException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executor.<span style=color:#a6e22e>shutdown</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=atomic-variables>Atomic Variables</h2><p>Atomic classes cung cấp thread-safe operations mà không cần synchronization.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.atomic.AtomicInteger;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AtomicExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> AtomicInteger counter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AtomicInteger(0);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        Runnable task <span style=color:#f92672>=</span> () <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 1000; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                counter.<span style=color:#a6e22e>incrementAndGet</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(task);
</span></span><span style=display:flex><span>        Thread thread2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(task);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>        thread2.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>        thread2.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Final counter: &#34;</span> <span style=color:#f92672>+</span> counter.<span style=color:#a6e22e>get</span>()); <span style=color:#75715e>// 2000</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=concurrent-collections>Concurrent Collections</h2><p>Java cung cấp các collection thread-safe.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ConcurrentHashMap;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ConcurrentLinkedQueue;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ConcurrentCollectionsExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ConcurrentHashMap - thread-safe HashMap</span>
</span></span><span style=display:flex><span>        ConcurrentHashMap<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentHashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ConcurrentLinkedQueue - thread-safe Queue</span>
</span></span><span style=display:flex><span>        ConcurrentLinkedQueue<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> queue <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentLinkedQueue<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Runnable producer <span style=color:#f92672>=</span> () <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 10; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                String item <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Item-&#34;</span> <span style=color:#f92672>+</span> i;
</span></span><span style=display:flex><span>                queue.<span style=color:#a6e22e>offer</span>(item);
</span></span><span style=display:flex><span>                map.<span style=color:#a6e22e>put</span>(item, i);
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Produced: &#34;</span> <span style=color:#f92672>+</span> item);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Runnable consumer <span style=color:#f92672>=</span> () <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 10; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                String item <span style=color:#f92672>=</span> queue.<span style=color:#a6e22e>poll</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (item <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Consumed: &#34;</span> <span style=color:#f92672>+</span> item <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; -&gt; &#34;</span> <span style=color:#f92672>+</span> map.<span style=color:#a6e22e>get</span>(item));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread producerThread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(producer);
</span></span><span style=display:flex><span>        Thread consumerThread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(consumer);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        producerThread.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>        consumerThread.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        producerThread.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>        consumerThread.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=deadlock>Deadlock</h2><p>Deadlock xảy ra khi hai hoặc nhiều threads chờ lẫn nhau.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DeadlockExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Object lock1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Object lock2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Thread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>synchronized</span> (lock1) {
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread 1: Holding lock 1&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> { Thread.<span style=color:#a6e22e>sleep</span>(100); } <span style=color:#66d9ef>catch</span> (InterruptedException e) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread 1: Waiting for lock 2&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>synchronized</span> (lock2) {
</span></span><span style=display:flex><span>                    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread 1: Holding lock 1 &amp; 2&#34;</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Thread thread2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>synchronized</span> (lock2) {
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread 2: Holding lock 2&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> { Thread.<span style=color:#a6e22e>sleep</span>(100); } <span style=color:#66d9ef>catch</span> (InterruptedException e) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread 2: Waiting for lock 1&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>synchronized</span> (lock1) {
</span></span><span style=display:flex><span>                    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread 2: Holding lock 1 &amp; 2&#34;</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>        thread2.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=best-practices>Best Practices</h2><ol><li><strong>Tránh nested locks</strong>: Giảm nguy cơ deadlock</li><li><strong>Sử dụng high-level concurrency utilities</strong>: ExecutorService, concurrent collections</li><li><strong>Hiểu rõ happens-before relationship</strong>: Đảm bảo memory visibility</li><li><strong>Sử dụng immutable objects</strong>: Khi có thể</li><li><strong>Test concurrency code</strong>: Sử dụng stress testing</li><li><strong>Document thread-safety</strong>: Rõ ràng về thread-safety guarantees</li></ol><h2 id=ví-dụ-thực-tế-web-crawler>Ví dụ thực tế: Web Crawler</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.*;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Set;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.atomic.AtomicInteger;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebCrawler</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ExecutorService executor;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ConcurrentHashMap<span style=color:#f92672>&lt;</span>String, Boolean<span style=color:#f92672>&gt;</span> visited;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> BlockingQueue<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> queue;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> AtomicInteger activeTasks;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>WebCrawler</span>(<span style=color:#66d9ef>int</span> numThreads) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>executor</span> <span style=color:#f92672>=</span> Executors.<span style=color:#a6e22e>newFixedThreadPool</span>(numThreads);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>visited</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentHashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>queue</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedBlockingQueue<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>activeTasks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AtomicInteger(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>crawl</span>(String startUrl) {
</span></span><span style=display:flex><span>        queue.<span style=color:#a6e22e>offer</span>(startUrl);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 10; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            executor.<span style=color:#a6e22e>submit</span>(<span style=color:#66d9ef>this</span>::crawlTask);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>crawlTask</span>() {
</span></span><span style=display:flex><span>        activeTasks.<span style=color:#a6e22e>incrementAndGet</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!</span>queue.<span style=color:#a6e22e>isEmpty</span>() <span style=color:#f92672>||</span> activeTasks.<span style=color:#a6e22e>get</span>() <span style=color:#f92672>&gt;</span> 1) {
</span></span><span style=display:flex><span>                String url <span style=color:#f92672>=</span> queue.<span style=color:#a6e22e>poll</span>(1, TimeUnit.<span style=color:#a6e22e>SECONDS</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (url <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (visited.<span style=color:#a6e22e>putIfAbsent</span>(url, <span style=color:#66d9ef>true</span>) <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Crawling: &#34;</span> <span style=color:#f92672>+</span> url);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Simulate crawling</span>
</span></span><span style=display:flex><span>                Thread.<span style=color:#a6e22e>sleep</span>(1000);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Add more URLs (simplified)</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (visited.<span style=color:#a6e22e>size</span>() <span style=color:#f92672>&lt;</span> 50) {
</span></span><span style=display:flex><span>                    queue.<span style=color:#a6e22e>offer</span>(url <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/page&#34;</span> <span style=color:#f92672>+</span> visited.<span style=color:#a6e22e>size</span>());
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>interrupt</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            activeTasks.<span style=color:#a6e22e>decrementAndGet</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shutdown</span>() {
</span></span><span style=display:flex><span>        executor.<span style=color:#a6e22e>shutdown</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            executor.<span style=color:#a6e22e>awaitTermination</span>(10, TimeUnit.<span style=color:#a6e22e>SECONDS</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            executor.<span style=color:#a6e22e>shutdownNow</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        WebCrawler crawler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WebCrawler(5);
</span></span><span style=display:flex><span>        crawler.<span style=color:#a6e22e>crawl</span>(<span style=color:#e6db74>&#34;http://example.com&#34;</span>);
</span></span><span style=display:flex><span>        crawler.<span style=color:#a6e22e>shutdown</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=kết-luận>Kết luận</h2><p>Multithreading là một chủ đề phức tạp nhưng mạnh mẽ trong Java. Việc hiểu rõ các khái niệm cơ bản như synchronization, thread communication, và các công cụ concurrency sẽ giúp bạn viết code đa luồng hiệu quả và an toàn.</p></div></div></section></main><footer><div class=footer-content><div class=footer-section><h3>My Blog</h3><p>Khám phá những bài viết chất lượng về công nghệ, lập trình, và các
xu hướng mới nhất.</p></div><div class=footer-section><h3>Liên kết nhanh</h3><ul><li><a href=../../>Trang Chủ</a></li><li><a href=../../about>Về tôi</a></li><li><a href=../../posts>Blog</a></li><li><a href=../../contact>Liên hệ</a></li></ul></div><div class=footer-section><h3>Danh mục</h3><ul><li><a href=../../categories/web-development>Web Development</a></li><li><a href=../../categories/trí-tuệ-nhân-tạo>AI</a></li><li><a href=../../categories/java>Java</a></li><li><a href=../../categories/javascript>JavaScript</a></li></ul></div><div class=footer-section><h3>Kết nối</h3><div class=social-links><a href=https://www.facebook.com/trung.tran.572662><i class="fab fa-facebook"></i></a>
<a href=#><i class="fab fa-twitter"></i></a>
<a href=https://www.instagram.com/trungkg915/><i class="fab fa-instagram"></i></a>
<a href=#><i class="fab fa-github"></i></a></div></div></div><div class=footer-bottom><p>&copy; 2025 My Blog. All rights reserved.</p></div></footer><script>const toggleButton=document.getElementById("dark-mode-toggle"),body=document.body,icon=toggleButton.querySelector("i"),currentTheme=localStorage.getItem("theme")||"light";currentTheme==="dark"&&(body.classList.add("dark-mode"),icon.classList.remove("fa-moon"),icon.classList.add("fa-sun")),toggleButton.addEventListener("click",()=>{body.classList.toggle("dark-mode");const e=body.classList.contains("dark-mode")?"dark":"light";localStorage.setItem("theme",e),e==="dark"?(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun")):(icon.classList.remove("fa-sun"),icon.classList.add("fa-moon"))})</script></body></html>